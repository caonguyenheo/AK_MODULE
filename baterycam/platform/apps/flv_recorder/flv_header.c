/*
 * Copyright (C) 2017 Cinatic
 *
 * This program is free software; you can redistribute it and/or
 * modify it under the terms of the GNU General Public License
 * as published by the Free Software Foundation; either version 2
 * of the License, or (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program. If not, see <http://www.gnu.org/licenses/>.
 */

/* FILE   : flv_header.c
 * AUTHOR : leon
 * DATE   : Sept 11, 2017
 * DESC   : Using auto tool to gen
 */

#include "flv_rec_os.h"
#include "mux.h"
#include "ak_apps_config.h"

static unsigned char const flv_header_buf[365] =
    {
    0x46, 0x4C, 0x56, 0x01, 0x05, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
    0x00, 0x12, 0x00, 0x01, 0x51, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x02, 0x00, 0x0A, 0x6F, 0x6E, 0x4D, 0x65, 0x74, 0x61, 0x44, 0x61, 0x74,
    0x61, 0x08, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x08, 0x64, 0x75, 0x72, 0x61,
#if (SYS_RECORD_DURATION_TIME == 15)
    0x74, 0x69, 0x6F, 0x6E, 0x00, 0x40, 0x2E, 0x00, 0x00, 0x00, 0x00, 0x00,
#else
//    0x74, 0x69, 0x6F, 0x6E, 0x00, 0x40, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x74, 0x69, 0x6F, 0x6E, 0x00, 0x40, 0x28, 0x00, 0x00, 0x00, 0x00, 0x00,
#endif    
    0x00, 0x00, 0x05, 0x77, 0x69, 0x64, 0x74, 0x68, 0x00, 0x40, 0x84, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x68, 0x65, 0x69, 0x67, 0x68,
    0x74, 0x00, 0x40, 0x76, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D,
    0x76, 0x69, 0x64, 0x65, 0x6F, 0x64, 0x61, 0x74, 0x61, 0x72, 0x61, 0x74,
    0x65, 0x00, 0x40, 0x82, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x09,
    0x66, 0x72, 0x61, 0x6D, 0x65, 0x72, 0x61, 0x74, 0x65, 0x00, 0x40, 0x28,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x76, 0x69, 0x64, 0x65,
    0x6F, 0x63, 0x6F, 0x64, 0x65, 0x63, 0x69, 0x64, 0x00, 0x40, 0x1C, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0D, 0x61, 0x75, 0x64, 0x69, 0x6F,
    0x64, 0x61, 0x74, 0x61, 0x72, 0x61, 0x74, 0x65, 0x00, 0x40, 0x60, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x61, 0x75, 0x64, 0x69, 0x6F,
    0x73, 0x61, 0x6D, 0x70, 0x6C, 0x65, 0x72, 0x61, 0x74, 0x65, 0x00, 0x40,
    0xBF, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x61, 0x75, 0x64,
    0x69, 0x6F, 0x73, 0x61, 0x6D, 0x70, 0x6C, 0x65, 0x73, 0x69, 0x7A, 0x65,
    0x00, 0x40, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x73,
    0x74, 0x65, 0x72, 0x65, 0x6F, 0x01, 0x00, 0x00, 0x0C, 0x61, 0x75, 0x64,
    0x69, 0x6F, 0x63, 0x6F, 0x64, 0x65, 0x63, 0x69, 0x64, 0x00, 0x40, 0x1C,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0A, 0x73, 0x74, 0x72, 0x65,
    0x61, 0x6D, 0x4E, 0x61, 0x6D, 0x65, 0x02, 0x00, 0x0E, 0x44, 0x6F, 0x6F,
    0x72, 0x42, 0x65, 0x6C, 0x6C, 0x53, 0x74, 0x72, 0x65, 0x61, 0x6D, 0x00,
    0x07, 0x65, 0x6E, 0x63, 0x6F, 0x64, 0x65, 0x72, 0x02, 0x00, 0x0D, 0x4C,
    0x61, 0x76, 0x66, 0x35, 0x35, 0x2E, 0x31, 0x32, 0x2E, 0x31, 0x30, 0x30,
    0x00, 0x06, 0x61, 0x75, 0x74, 0x68, 0x6F, 0x72, 0x02, 0x00, 0x04, 0x6C,
    0x65, 0x6F, 0x6E, 0x00, 0x08, 0x66, 0x69, 0x6C, 0x65, 0x73, 0x69, 0x7A,
    0x65, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x09, 0x00, 0x00, 0x01, 0x5C
    };

/*
 * PURPOSE : Get full flv header
 * INPUT   : [data]     - Data pointer
 *           [max_size] - Max size of data
 * OUTPUT  : [data]     - FLV header to be copied
 * RETURN  : FLV header size
 * DESCRIPT: None
 */
int
DoorBellFLVHeaderGen(void* data, int max_size)
    {
    if(max_size > sizeof(flv_header_buf))
        return 0;
    else if(data == NULL)
        return 0;
    else
        {
        memcpy(data, flv_header_buf, sizeof(flv_header_buf));
        return sizeof(flv_header_buf);
        }
    }

/*
 * PURPOSE : Write first header to file
 * INPUT   : [pFile] - File pointer
 * OUTPUT  : None
 * RETURN  : FLV header size
 * DESCRIPT: None
 */
int
DoorBellFLVHeaderWrite(FILE* pFile)
    {
    if(pFile == NULL)
        return 0;
    else
        {
//        return fwrite(flv_header_buf, sizeof(char), sizeof(flv_header_buf), pFile);
        return f_mem_write(flv_header_buf, sizeof(char), sizeof(flv_header_buf), pFile);
        }
    }
